# MARM Bot ‚Äî Telegram‚Äë–±–æ—Ç —Å–∫–ª–∞–¥—Å–∫–æ–≥–æ —É—á—ë—Ç–∞ (–æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–π –≥–∞–π–¥)

–¢–µ–ª–µ–≥—Ä–∞–º‚Äë–±–æ—Ç –Ω–∞ aiogram 3.7 + Python 3.12 —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î SQLite (WAL, FTS5 –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏). –≠—Ç–∞ –≤–µ—Ä—Å–∏—è README –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–µ—Ç–∞–ª–∏ –∏–∑ –ø–æ–ª–Ω–æ–≥–æ –∏ –∫—Ä–∞—Ç–∫–æ–≥–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤ –∏ –¥–æ–ø–æ–ª–Ω—è–µ—Ç –∏—Ö –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è–º–∏.

‚Äî –Ø–∑—ã–∫: Python 3.12 ‚Ä¢ –•—Ä–∞–Ω–∏–ª–∏—â–µ: SQLite ‚Ä¢ –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: `app/main.py` ‚Ä¢ –ü–∞–∫–µ—Ç: `app/*`

<img src="media/readme/main_menu.png" alt="–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (–º–∞–∫–µ—Ç)" width="720" />

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
3. –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (—Å –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è–º–∏)
4. –ü–æ–∏—Å–∫ (inline)
5. –û—Ç—á—ë—Ç—ã (CSV)
6. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
7. –§–æ—Ç–æ —Ç–æ–≤–∞—Ä–æ–≤
8. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
9. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
10. –°—Ç—Ä–µ—Å—Å‚Äë—Ç–µ—Å—Ç—ã
11. –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ
12. –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
13. –§–∞–π–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞

---

## 1) –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.12 (macOS: `brew install python@3.12`)
- –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ Telegram API

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (macOS): `./run_bot.command`
- –í—Ä—É—á–Ω—É—é (macOS/Linux/Windows):
```
python3.12 -m venv venv
source venv/bin/activate        # Windows: venv\Scripts\activate
pip install -U pip
pip install -r requirements.txt
python -m app.main
```

–ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥
- –ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É `/start` —Å –∞–∫–∫–∞—É–Ω—Ç–∞ –≥–ª–∞–≤–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∞ (—Å–º. –∫–æ–Ω—Ñ–∏–≥). –û—Ç–∫—Ä–æ–µ—Ç—Å—è ¬´–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é¬ª.

### –õ–æ–∫–∞–ª—å–Ω–∞—è –≤–µ–±‚Äë–∞–¥–º–∏–Ω–∫–∞ –ë–î (–∫—Ä–∞—Å–∏–≤—ã–π UI)

–ó–∞–ø—É—Å–∫–∞–µ—Ç —É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è SQLite‚Äë–±–∞–∑—ã:

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏: `./run_admin.command`
  - –°–ª—É—à–∞–µ—Ç –Ω–∞ `0.0.0.0:${ADMIN_PORT:-8000}`
  - –î–æ—Å—Ç—É–ø —Å —ç—Ç–æ–π –º–∞—à–∏–Ω—ã: `http://127.0.0.1:8000`
  - –î–æ—Å—Ç—É–ø –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏: `http://<IP_—ç—Ç–æ–π_–º–∞—à–∏–Ω—ã>:8000` (—Å–∫—Ä–∏–ø—Ç –ø–æ–¥—Å–∫–∞–∂–µ—Ç IP)
- –í—Ä—É—á–Ω—É—é:
```
python3.12 -m venv venv
source venv/bin/activate        # Windows: venv\Scripts\activate
pip install -U pip
pip install -r requirements.txt
python -m admin_ui              # –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 127.0.0.1:8000
# –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ —Å–µ—Ç–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–∞–∫:
# ADMIN_HOST=0.0.0.0 ADMIN_PORT=8000 python -m admin_ui
```

–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- –ü—Ä–æ—Å–º–æ—Ç—Ä –ª—é–±—ã—Ö —Ç–∞–±–ª–∏—Ü/–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π, –ø–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–º –ø–æ–ª—è–º, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞, –ø–∞–≥–∏–Ω–∞—Ü–∏—è.
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/–∏–∑–º–µ–Ω–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü —Å –ø–µ—Ä–≤–∏—á–Ω—ã–º –∫–ª—é—á–æ–º (PK).
- –î–ª—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü/–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π ‚Äî —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ.
- UI –Ω–∞ Bootstrap, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ, –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã).

## 2) –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

`config.json` —Ä—è–¥–æ–º —Å `app/main.py`:
```json
{
  "BOT_TOKEN": "<–≤–∞—à_telegram_bot_token>",
  "SUPER_ADMIN_ID": 123456789,
  "SUPER_ADMIN_USERNAME": "@your_username"
}
```
–ó–∞–º–µ–Ω—ã —á–µ—Ä–µ–∑ –æ–∫—Ä—É–∂–µ–Ω–∏–µ: `BOT_TOKEN`, `SUPER_ADMIN_ID`, `SUPER_ADMIN_USERNAME`.

## 3) –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∏–∂–µ ‚Äî –º–∞–∫–µ—Ç—ã UI (–¥–ª—è –æ—Ä–∏–µ–Ω—Ç–∏—Ä–∞).

### 3.1 –ü–æ—Å—Ç–∞–≤–∫–∞ ‚Üí –∏–º–ø–æ—Ä—Ç CSV

<img src="media/readme/supply_import.png" alt="–ü–æ—Å—Ç–∞–≤–∫–∞ –∏ –∏–º–ø–æ—Ä—Ç (–º–∞–∫–µ—Ç)" width="720" />

- ¬´–ü–æ—Å—Ç–∞–≤–∫–∞ ‚Üí üìÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å CSV¬ª. –ü–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π—Ç–µ –∏—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª –≤ CSV: https://convertio.co/ru/xls-csv/
- –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ø–æ–ª—É—á–∏–≤—à–∏–π—Å—è `.csv`.
- –§–∞–π–ª –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è –≤ `article,name,qty` ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `data/uploads/normalized`.
- –ù–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã –ø–æ–º–µ—á–∞—é—Ç—Å—è `is_new=1`, –æ—Å—Ç–∞—Ç–æ–∫ –∑–∞—á–∏—Å–ª—è–µ—Ç—Å—è –≤ `SKL-0`.
- –†–∞–∑–ª–æ–∂–∏—Ç–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–ª–∏ ¬´–ú–∞—Ä—à—Ä—É—Ç: –æ—Ç–∫—É–¥–∞ ‚Üí –∫—É–¥–∞¬ª.

### 3.2 –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞

- –û—Å—Ç–∞—Ç–∫–∏ –ø–æ –ª–æ–∫–∞—Ü–∏—è–º, –∏—Ç–æ–≥, –ª–æ–∫–∞–ª—å–Ω–æ–µ –∏–º—è, —Ñ–æ—Ç–æ.
- –ë—ã—Å—Ç—Ä–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ: ¬´–í –∑–∞–ª (‚àí1)¬ª.
- –ú–∞—Ä—à—Ä—É—Ç: –≤—ã–±–µ—Ä–∏—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫/–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ.
- –°–ø–µ—Ü‚Äë–∫–Ω–æ–ø–∫–∞ ¬´–í—Å—ë –∏–∑ SKL‚Äë0 ‚Üí –•¬ª: –µ—Å–ª–∏ –µ—Å—Ç—å –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –ª–æ–∫–∞—Ü–∏—è.
- –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏: ¬´–î–æ–±–∞–≤–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ¬ª, ¬´–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ¬ª (JPEG √ó0.5, –∫–µ—à –ª–æ–∫–∞–ª—å–Ω–æ).

### 3.3 –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è

<img src="media/readme/inventory.png" alt="–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è (–º–∞–∫–µ—Ç)" width="720" />

- ¬´–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è¬ª ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ –ª–æ–∫–∞—Ü–∏—é ‚Üí –æ—Ç–∫—Ä–æ–π—Ç–µ –ø–æ–∑–∏—Ü–∏—é.
- –ö–Ω–æ–ø–∫–∞–º–∏ –∑–∞–¥–∞–π—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ (‚àí5/‚àí1/+1/+5, ¬´‚úÖ —á–∏—Å–ª–æ¬ª) –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ ¬´‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤ X¬ª –∏–ª–∏ ¬´‚ûñ –£–±–∞–≤–∏—Ç—å –∏–∑ X¬ª.
- –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –∞—Ç–æ–º–∞—Ä–Ω—ã, –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –æ—Å—Ç–∞—Ç–∫–∏ –∑–∞–ø—Ä–µ—â–µ–Ω—ã.

## 4) –ü–æ–∏—Å–∫ (inline)

–í —á–∞—Ç–µ —Å –±–æ—Ç–æ–º –Ω–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∑–∞–ø—Ä–æ—Å (–Ω–∞–∑–≤–∞–Ω–∏–µ/–∞—Ä—Ç–∏–∫—É–ª) –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Å–∫–∞–∑–∫—É. –ü—Ä–µ—Ñ–∏–∫—Å—ã:
- `INV ` ‚Äî –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è, –≤—Å—Ç–∞–≤–ª—è–µ—Ç `/inv_<id>`
- `NEW ` ‚Äî —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ (`is_new=1`)
- `INC ` ‚Äî –Ω–µ–∑–∞–ø–æ–ª–Ω—ë–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ (–Ω–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∏–º–µ–Ω–∏/—Ñ–æ—Ç–æ)
- `ADM ` ‚Äî –∞–¥–º–∏–Ω‚Äë–¥–µ–π—Å—Ç–≤–∏—è, –≤—Å—Ç–∞–≤–ª—è–µ—Ç `/admin_<id>`
  - –î–ª—è –∞–¥–º–∏–Ω–æ–≤ —Ç–∞–∫–∂–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—É–Ω–∫—Ç ¬´‚ûï –°–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä: <–∑–∞–ø—Ä–æ—Å>¬ª, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/admin_new <–∑–∞–ø—Ä–æ—Å>` –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –º–∞—Å—Ç–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è —Å –≤—ã–±–æ—Ä–æ–º –ª–æ–∫–∞—Ü–∏–∏ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞.

–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–∞–≤–∫–∞ –∏–∑ —á–∞—Ç–∞ (–¥–ª—è –∞–¥–º–∏–Ω–æ–≤):
- `/admin_set <id> <–ø–æ–ª–µ>=<–∑–Ω–∞—á–µ–Ω–∏–µ>` ‚Äî –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞–ø—Ä—è–º—É—é, –ø–æ–ª—è: `article`, `name`, `local_name`, `brand_country`, `is_new`.
  - –ü—Ä–∏–º–µ—Ä—ã: `/admin_set 123 name=–ù–æ–≤–æ–µ –∏–º—è`, `/admin_set 123 is_new=0`.

–ü–æ–¥ –∫–∞–ø–æ—Ç–æ–º FTS5 (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ), –∏–Ω–∞—á–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π fallback –Ω–∞ LIKE.

## 5) –û—Ç—á—ë—Ç—ã (CSV)

- ¬´–û—Ç—á—ë—Ç—ã¬ª: ¬´–ó–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è (<2)¬ª, ¬´–ù—É–ª–µ–≤–æ–π –æ—Å—Ç–∞—Ç–æ–∫¬ª, ¬´–í –¥–æ—Å—Ç–∞—Ç–∫–µ 3‚Äì5¬ª, ¬´–í—Å–µ —Ç–æ–≤–∞—Ä—ã¬ª, ¬´–ê—Ä—Ö–∏–≤¬ª.
- –§–∞–π–ª—ã –≤ `reports/` –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ —á–∞—Ç.
  - –ê—Ä—Ö–∏–≤–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–º–µ—á–∞—é—Ç—Å—è, –µ—Å–ª–∏ –ø—Ä–∏ –Ω—É–ª–µ–≤–æ–º –æ—Å—Ç–∞—Ç–∫–µ –Ω–µ –±—ã–ª–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–π 30 –¥–Ω–µ–π. –û–Ω–∏ —Å–∫—Ä—ã—Ç—ã –∏–∑ –æ–±—â–µ–≥–æ –ø–æ–∏—Å–∫–∞ –∏ –≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ –≤ –æ—Ç—á—ë—Ç–µ ¬´–ê—Ä—Ö–∏–≤¬ª.

## 6) –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–¢–∏–ø—ã: –∑–∞–∫–æ–Ω—á–∏–ª—Å—è, –ø–æ—Å–ª–µ–¥–Ω—è—è –ø–∞—á–∫–∞, –ø–æ—Å—Ç—É–ø–∏–ª–æ –Ω–∞ —Å–∫–ª–∞–¥. –†–µ–∂–∏–º—ã: `off` / `daily` / `instant`.
- –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ ‚Äî –ø—Ä–∏—Ö–æ–¥—è—Ç —Å—Ä–∞–∑—É –ø—Ä–∏ —Å–æ–±—ã—Ç–∏—è—Ö.
- –°–≤–æ–¥–∫–∞ ‚Äî –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 21:10.
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞: ¬´–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è¬ª –≤ –∞–¥–º–∏–Ω–∫–µ.

## 7) –§–æ—Ç–æ —Ç–æ–≤–∞—Ä–æ–≤

- –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ ‚Äî –±–æ—Ç —Å–∫–∞—á–∞–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª, —Å–æ–∂–º—ë—Ç –¥–æ JPEG √ó0.5 (`PHOTO_QUALITY`) –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç –≤ `media/photos`.
- –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–º–µ–Ω–∏—Ç —Ñ–æ—Ç–æ. –£–¥–∞–ª–µ–Ω–∏–µ ‚Äî ¬´–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å ‚Üí –§–æ—Ç–æ: —É–¥–∞–ª–∏—Ç—å¬ª.

## 8) –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- SQLite WAL, `busy_timeout`, `synchronous=NORMAL` ‚Äî —É—Å—Ç–æ–π—á–∏–≤–æ –∫ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏.
- –¢–∞–±–ª–∏—Ü—ã: `product`, `location`, `stock`, `user_role`, `user_notify`, `event_log`, –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è `product_fts`.
- –ú–∏–≥—Ä–∞—Ü–∏–∏/—Å–∏–¥–∏–Ω–≥ ‚Äî –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (`app/db.py`).

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–º–µ—Ä–º–∞–¥)
```mermaid
flowchart LR
  User((User)) --> TG[Telegram]
  TG --> Bot[MARM Bot (aiogram)]
  Bot --> H1[Handlers: supply / stock / inventory / reports / admin]
  H1 --> S1[Services: imports]
  H1 --> S2[Services: stock]
  H1 --> S3[Services: notify]
  H1 --> S4[Services: photos]
  Bot --> DB[(SQLite: product / stock / ...)]
```

## 9) –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

- –ë–î: `data/marm.sqlite3`
- –ó–∞–≥—Ä—É–∑–∫–∏: `data/uploads` ‚Üí –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ CSV: `data/uploads/normalized`
- –§–æ—Ç–æ: `media/photos`
- –û—Ç—á—ë—Ç—ã: `reports`
- JPEG –∫–∞—á–µ—Å—Ç–≤–æ: `PHOTO_QUALITY = 85` (`app/config.py`)
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è: `PAGE_SIZE=10`, `CARDS_PAGE_SIZE=20`, `STOCK_PAGE_SIZE=30`

## 10) –°—Ç—Ä–µ—Å—Å‚Äë—Ç–µ—Å—Ç—ã

–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ Telegram:
```
python stress_test.py
```
–°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞—ë—Ç —Ç–µ—Å—Ç–æ–≤—É—é –ë–î `data/stress.sqlite3`, –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ CSV –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, –≤—ã–ø–æ–ª–Ω—è–µ—Ç –º–∞—Å—Å–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è/–∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã/FTS, –∏–º–∏—Ç–∏—Ä—É–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç —Å–∂–∞—Ç–∏–µ —Ñ–æ—Ç–æ. –û–∂–∏–¥–∞–π—Ç–µ `OVERALL: OK`.

## 11) –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ

- systemd (Linux): —É–∫–∞–∂–∏—Ç–µ `ExecStart` –Ω–∞ –∑–∞–ø—É—Å–∫ –≤ venv, –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–∞–º –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏—è (`BOT_TOKEN`, `SUPER_ADMIN_ID`, `SUPER_ADMIN_USERNAME`).
- macOS: `launchd` –∏–ª–∏ `./run_bot.command` (—Ç–µ—Ä–º–∏–Ω–∞–ª –æ—Ç–∫—Ä—ã—Ç), –º–æ–∂–Ω–æ –æ—Ñ–æ—Ä–º–∏—Ç—å –∫–∞–∫ LaunchAgent.
- Windows (2 –∫–ª–∏–∫–∞ + —Å–∞–º–æ–ø–æ–¥—ä—ë–º):
  - –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫: `windows\install_marmbot.bat` ‚Äî —Å–æ–∑–¥–∞—Å—Ç venv, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∑–∞–¥–∞—á—É –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ ¬´MarmBot¬ª —Å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–æ–º –∏ —Å–∞–º–æ–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º.
  - –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫: –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ —Å–∏—Å—Ç–µ–º—É, –ø—Ä–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–µ —Ä–∞–±–æ—á–µ–≥–æ —Å—Ç–æ–ª–∞ –∏ –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Å–Ω–∞ (–ø–æ —Å–æ–±—ã—Ç–∏—é `Power‚ÄëTroubleshooter/1`).
  - –°–∞–º–æ–ø–æ–¥—ä—ë–º: –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è (–ø–æ–≤—Ç–æ—Ä –¥–æ 999 —Ä–∞–∑, –ø–∞—É–∑–∞ 10 —Å–µ–∫). –ü—Ä–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–µ/–ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–∏ ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Ç–µ–∫—É—â–µ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞.
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
    - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ–π—á–∞—Å: `windows\start_now.bat`
    - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å: `windows\stop.bat`
    - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å: `windows\restart_now.bat`
    - –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É: `windows\uninstall_marmbot.bat`
  - –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: –∑–∞–¥–∞—á–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç `venv\Scripts\python.exe app\main.py` –∏–∑ –∫–æ—Ä–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è. –ö–æ–Ω—Ñ–∏–≥ –±–µ—Ä—ë—Ç—Å—è –∏–∑ `config.json` –≤ —ç—Ç–æ–º –∂–µ –∫–∞—Ç–∞–ª–æ–≥–µ.

## 12) –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

- –ù–µ—Ç `BOT_TOKEN`/`SUPER_ADMIN_ID` ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `config.json` –∏–ª–∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ.
- –ù–µ—Ç Python 3.12 ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ (macOS: `brew install python@3.12`).
- –û—à–∏–±–∫–∏ `.xls` ‚Äî –Ω—É–∂–µ–Ω `xlrd==1.2.0` (–≤ `requirements.txt`).
- FTS –ø–∞–¥–∞–µ—Ç ‚Äî –±—É–¥–µ—Ç fallback –Ω–∞ LIKE.
- ¬´database is locked¬ª –ø—Ä–∏ –ø–∏–∫–æ–≤–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ ‚Äî –ø–æ–¥–æ–∂–¥–∏—Ç–µ/–ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ; WAL –∏ `busy_timeout` –≤–∫–ª—é—á–µ–Ω—ã.
- –§–æ—Ç–æ –Ω–µ –≤–∏–¥–Ω–æ ‚Äî –¥–æ–∂–¥–∏—Ç–µ—Å—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ.

---

## –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è (Docker)

–ë—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± –ø–æ–¥–Ω—è—Ç—å –±–æ—Ç–∞ –∏ –≤–µ–±‚Äë–∞–¥–º–∏–Ω–∫—É –Ω–∞ –ª—é–±–æ–º —Ö–æ—Å—Ç–µ –∏ –æ—Ç–∫—Ä—ã—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω–∫–µ –ø–æ –ª–æ–∫–∞–ª—å–Ω–æ–º—É/–í–ü–ù‚ÄëIP (–Ω–µ `localhost`).

- –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏: Docker Engine + Docker Compose V2.

–®–∞–≥–∏
- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ:
  - `BOT_TOKEN`, `SUPER_ADMIN_ID`, `SUPER_ADMIN_USERNAME`
  - `ADMIN_PORT` (–≤–Ω–µ—à–Ω–∏–π –ø–æ—Ä—Ç –∞–¥–º–∏–Ω–∫–∏, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 8000)
- –ó–∞–ø—É—Å–∫:
```
docker compose up -d --build
```
- –î–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω–∫–µ: `http://<IP_–º–∞—à–∏–Ω—ã>:<ADMIN_PORT>`
  - –ü—Ä–∏–º–µ—Ä—ã IP: –ª–æ–∫–∞–ª—å–Ω–∞—è —Å–µ—Ç—å (192.168.x.x), –∞–¥—Ä–µ—Å –í–ü–ù‚Äë–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ‚Äî –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∞—à–µ–π VPN.
  - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–µ—Ä–≤–æ–ª–ª/–ø—Ä–∞–≤–∏–ª–∞ –í–ü–ù —Ä–∞–∑—Ä–µ—à–∞—é—Ç –≤—Ö–æ–¥ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–æ—Ä—Ç.

–°–µ—Ä–≤–∏—Å—ã
- `admin` ‚Äî Flask‚Äë–∞–¥–º–∏–Ω–∫–∞ (`python -m admin_ui`), —Å–ª—É—à–∞–µ—Ç –Ω–∞ `0.0.0.0:8000` –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
- `bot` ‚Äî Telegram‚Äë–±–æ—Ç (`python -m app.main`).

–î–∞–Ω–Ω—ã–µ (—Ç–æ–º–∞)
- `data` ‚Üí `/app/data` (SQLite –ë–î –∏ –∑–∞–≥—Ä—É–∑–∫–∏)
- `media` ‚Üí `/app/media` (—Ñ–æ—Ç–æ)
- `reports` ‚Üí `/app/reports` (CSV –æ—Ç—á—ë—Ç—ã)

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å: `docker compose down`
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–¥–∞: `docker compose up -d --build`
- –õ–æ–≥–∏: `docker compose logs -f admin` –∏/–∏–ª–∏ `docker compose logs -f bot`

–ü—Ä–∏–º–µ—á–∞–Ω–∏—è
- –§–∞–π–ª `config.json` —É–º—ã—à–ª–µ–Ω–Ω–æ –Ω–µ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ –æ–±—Ä–∞–∑ (—Å–º. `.dockerignore`). –°–µ–∫—Ä–µ—Ç—ã –∑–∞–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `.env`/–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.
- –ê–¥–º–∏–Ω–∫–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç —Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –ë–î –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –ø–æ—ç—Ç–æ–º—É –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –±–æ—Ç–∞.
- –ü—É—Ç—å –∫ –ë–î –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `DB_PATH` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `data/marm.sqlite3`). –ï—Å–ª–∏ —É –≤–∞—Å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è –±–∞–∑–∞ `data/marm.db`, –ø—Ä–æ–ø–∏—à–∏—Ç–µ `DB_PATH=data/marm.db` –≤ `.env`.

## 13) –§–∞–π–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞

- –í—Ö–æ–¥: `app/main.py`
- –ö–æ–Ω—Ñ–∏–≥/–ø—É—Ç–∏: `app/config.py`
- –ë–î/—Å—Ö–µ–º–∞/–ø—Ä–∞–≥–º—ã: `app/db.py`
- –ò–º–ø–æ—Ä—Ç: `app/services/imports.py`
- –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏—è/–∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è: `app/services/stock.py`
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: `app/services/notify.py`
- –§–æ—Ç–æ: `app/services/photos.py`
- UI/—Ç–µ–∫—Å—Ç—ã/–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã: `app/ui/*`
- –•–µ–Ω–¥–ª–µ—Ä—ã: `app/handlers/*`
